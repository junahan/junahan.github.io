<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>如何发布项目包至 Maven 中心仓库 - Junahan - Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Junahan" /><meta name="description" content="1 摘要 本文简单说明如何部署 (Deploy) Maven 项目至 OSSRH 仓库并发布 (Release) 至 Maven 中心 （Maven Centre）仓库。 2 基本要求 要发布项目到 Maven 中心仓库，需要遵循一些基本" /><meta name="keywords" content="Service Mesh, Blockchain, AI, Hyperledger" />






<meta name="generator" content="Hugo 0.60.0 with theme even" />


<link rel="canonical" href="/post/release-package-to-maven-centre-repository-101/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.6eb09ed45a88bd339269c14515d2a11f2e0afdadbdd763d83f9b5c797166b081.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="如何发布项目包至 Maven 中心仓库" />
<meta property="og:description" content="1 摘要 本文简单说明如何部署 (Deploy) Maven 项目至 OSSRH 仓库并发布 (Release) 至 Maven 中心 （Maven Centre）仓库。 2 基本要求 要发布项目到 Maven 中心仓库，需要遵循一些基本" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/release-package-to-maven-centre-repository-101/" />
<meta property="article:published_time" content="2018-06-10T00:00:00+08:00" />
<meta property="article:modified_time" content="2018-08-02T08:44:05+08:00" />
<meta itemprop="name" content="如何发布项目包至 Maven 中心仓库">
<meta itemprop="description" content="1 摘要 本文简单说明如何部署 (Deploy) Maven 项目至 OSSRH 仓库并发布 (Release) 至 Maven 中心 （Maven Centre）仓库。 2 基本要求 要发布项目到 Maven 中心仓库，需要遵循一些基本">
<meta itemprop="datePublished" content="2018-06-10T00:00:00&#43;08:00" />
<meta itemprop="dateModified" content="2018-08-02T08:44:05&#43;08:00" />
<meta itemprop="wordCount" content="3196">



<meta itemprop="keywords" content="Maven,Java,GPG,S101," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="如何发布项目包至 Maven 中心仓库"/>
<meta name="twitter:description" content="1 摘要 本文简单说明如何部署 (Deploy) Maven 项目至 OSSRH 仓库并发布 (Release) 至 Maven 中心 （Maven Centre）仓库。 2 基本要求 要发布项目到 Maven 中心仓库，需要遵循一些基本"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Junahan</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">分类</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Junahan</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">分类</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">关于</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">如何发布项目包至 Maven 中心仓库</h1>

      <div class="post-meta">
        <span class="post-time"> 2018-06-10 </span>
        <div class="post-category">
            <a href="/categories/dev/"> Dev </a>
            <a href="/categories/tools/"> Tools </a>
            <a href="/categories/s101/"> S101 </a>
            </div>
          <span class="more-meta"> 约 3196 字 </span>
          <span class="more-meta"> 预计阅读 7 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#摘要">1 摘要</a></li>
    <li><a href="#基本要求">2 基本要求</a></li>
    <li><a href="#准备-gpg-签名环境">3 准备 GPG 签名环境</a>
      <ul>
        <li><a href="#安装-gpg">3.1 安装 GPG</a></li>
        <li><a href="#创建秘钥对">3.2 创建秘钥对</a></li>
        <li><a href="#列出秘钥对">3.3 列出秘钥对</a></li>
        <li><a href="#分发你的公钥">3.4 分发你的公钥</a></li>
        <li><a href="#使用-gpg-keychain">3.5 使用 GPG Keychain</a></li>
      </ul>
    </li>
    <li><a href="#登录-ossrh-并创建项目信息">4 登录 OSSRH 并创建项目信息</a></li>
    <li><a href="#准备项目-pom">5 准备项目 POM</a>
      <ul>
        <li><a href="#配置项目基本信息">5.1 配置项目基本信息</a></li>
        <li><a href="#配置-distribution-management">5.2 配置 Distribution Management</a></li>
        <li><a href="#配置-maven-plugins">5.3 配置 Maven Plugins</a></li>
        <li><a href="#配置发布-profile">5.4 配置发布 Profile</a></li>
      </ul>
    </li>
    <li><a href="#配置-maven-setting">6 配置 Maven Setting</a></li>
    <li><a href="#执行-snapshot-部署">7 执行 Snapshot 部署</a></li>
    <li><a href="#使用-nexus-staging-插件执行部署和发布">8 使用 Nexus Staging 插件执行部署和发布</a></li>
    <li><a href="#使用-maven-release-插件执行部署和发布">9 使用 Maven Release 插件执行部署和发布</a></li>
    <li><a href="#gpg-plugin-issue">10 GPG Plugin Issue</a></li>
    <li><a href="#参考文献">11 参考文献</a></li>
  </ul>
</nav>
  </div>
</div>
  <div class="post-outdated">
    <div class="warn">
      <p>【注意】最后更新于 <span class="timeago" datetime="2018-08-02T08:44:05" title="August 2, 2018">August 2, 2018</span>，文中内容可能已过时，请谨慎使用。</p>
    </div>
  </div>
    <div class="post-content">
      <h2 id="摘要"><span class="section-num">1</span> 摘要</h2>
<p>本文简单说明如何部署 (Deploy) Maven 项目至 <a href="https://oss.sonatype.org">OSSRH</a> 仓库并发布 (Release) 至 Maven 中心 （Maven Centre）仓库。</p>
<h2 id="基本要求"><span class="section-num">2</span> 基本要求</h2>
<p>要发布项目到 Maven 中心仓库，需要遵循一些<a href="https://central.sonatype.org/pages/requirements.html">基本要求</a> ：</p>
<ul>
<li>随 Jar 包一起提供 Javadoc 和 Sources 包。</li>
<li>使用 <a href="https://gnupg.org.">GPG/PGP</a> 签名发布包。</li>
<li>提供必要的项目数据 - 在 POM 中包含必要的信息
<ul>
<li>正确的基本信息包括 <code>groupId</code> , <code>artifactId</code>, <code>version</code> 等</li>
<li>项目名称、描述和 URL</li>
<li>License 信息</li>
<li>开发者信息</li>
<li>SCM 信息</li>
</ul>
</li>
</ul>
<h2 id="准备-gpg-签名环境"><span class="section-num">3</span> 准备 GPG 签名环境</h2>
<h3 id="安装-gpg"><span class="section-num">3.1</span> 安装 GPG</h3>
<p>这里以 Mac 为例，安装 GPG 软件包</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">$ brew install gpg
...
$ gpg --version
gpg <span class="o">(</span>GnuPG<span class="o">)</span> 2.2.7
libgcrypt 1.8.2
Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2018</span> Free Software Foundation, Inc.
License GPLv3+: GNU GPL version <span class="m">3</span> or later &lt;https://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Home: /Users/junahan/.gnupg
支持的算法：
公钥：RSA, ELG, DSA, ECDH, ECDSA, EDDSA
对称加密：IDEA, 3DES, CAST5, BLOWFISH, AES, AES192, AES256,
     TWOFISH, CAMELLIA128, CAMELLIA192, CAMELLIA256
散列：SHA1, RIPEMD160, SHA256, SHA384, SHA512, SHA224
压缩：不压缩, ZIP, ZLIB, BZIP2
</code></pre></td></tr></table>
</div>
</div><h3 id="创建秘钥对"><span class="section-num">3.2</span> 创建秘钥对</h3>
<p>秘钥对包含一个私钥和一个公钥，私钥用于对发布包进行签名。相应的公钥可以通过 Key Server 分享给用户，用户可以使用该公钥对你的发布包进行验证。使用如下命令产生秘钥对：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">gpg --gen-key
</code></pre></td></tr></table>
</div>
</div><p>在创建秘钥对过程中，系统会询问加密算法类型和秘钥长度，建议使用 RSA 算法并使用 2048 bit 秘钥长度。另外需要输入的信息包括名字、Email地址等，另外需要输入安全密码。私钥和安全密码在签名你的发布包的时候需要使用。</p>
<h3 id="列出秘钥对"><span class="section-num">3.3</span> 列出秘钥对</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">$ gpg --list-keys
/Users/junahan/.gnupg/pubring.kbx
---------------------------------
pub   rsa2048 2018-06-15 <span class="o">[</span>SC<span class="o">]</span> <span class="o">[</span>有效至：2020-06-14<span class="o">]</span>
      388AB68B99E8E6069E9BB3FEFE50DC1E94282315
uid           <span class="o">[</span> 绝对 <span class="o">]</span> Junahan &lt;junahan@outlook.com&gt;
sub   rsa2048 2018-06-15 <span class="o">[</span>E<span class="o">]</span> <span class="o">[</span>有效至：2020-06-14<span class="o">]</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>其中 pub rsa2048… 一节就是你的公钥信息，388AB68B99E8E6069E9BB3FEFE50DC1E94282315 就是公钥 ID。</li>
</ul>
<h3 id="分发你的公钥"><span class="section-num">3.4</span> 分发你的公钥</h3>
<p>通过分发你的公钥到公钥服务器，用户可以通过公钥服务器下载你的公钥以验证你的发布包。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">gpg --keyserver hkps://hkps.pool.sks-keyservers.net --send-keys 388AB68B99E8E6069E9BB3FEFE50DC1E94282315
</code></pre></td></tr></table>
</div>
</div><h3 id="使用-gpg-keychain"><span class="section-num">3.5</span> 使用 GPG Keychain</h3>
<p>GPG Keychain 是 <a href="https://gpgtools.org">GPG Suite</a> 的一部分，它提供一个 GUI 界面，方便用户管理 GPG 秘钥。
以 Mac 为例，运行如下命令安装 GPG Suite：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">brew cask install gpg-suite
</code></pre></td></tr></table>
</div>
</div><h2 id="登录-ossrh-并创建项目信息"><span class="section-num">4</span> 登录 OSSRH 并创建项目信息</h2>
<p>访问 <a href="https://issues.sonatype.org">OSSRH</a> 注册账户并登录，该账号会在随后发布项目包时用作认证需要。使用 OSSRH 发布项目包之前，需要在 OSSRH 创建一个有关该项目的 Issue Ticket 并提供相关项目相关信息，包括项目名称、GroupId、项目代码地址等基本信息。创建 Issue Ticket 的界面如下图所示：</p>
<figure>
    <img src="https://ws2.sinaimg.cn/large/006tKfTcgy1ftu3ef52boj319a10i0wy.jpg"
         alt="Figure 1: 创建项目 Ticket"/> <figcaption>
            <p>Figure 1: 创建项目 Ticket</p>
        </figcaption>
</figure>

<ul>
<li>有关新项目的信息需要经过人工审核以确认提供的信息有效，特别是项目 GroupId 信息，审核在 2 个工作日内完成；</li>
<li>由于 GroupId 通常包含域名信息，如果你使用自己的域名，需要提供你是该域名拥有者的一些证据；</li>
<li>如果你在 Github 上托管代码，建议使用 com.github.${你的 GitHub 账户名} 作为 GroupId；</li>
</ul>
<h2 id="准备项目-pom"><span class="section-num">5</span> 准备项目 POM</h2>
<p>这里以项目 <a href="https://github.com/junahan/struts2-protobuf-plugin/tree/master/plugin-demo">struts2-protobuf-plugin</a> 为例。</p>
<h3 id="配置项目基本信息"><span class="section-num">5.1</span> 配置项目基本信息</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;groupId</span><span class="nt">&gt;</span>com.github.junahan<span class="nt">&lt;/groupId&gt;</span>
<span class="nt">&lt;artifactId</span><span class="nt">&gt;</span>struts2-protobuf-plugin-parent<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;version</span><span class="nt">&gt;</span>1.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;packaging</span><span class="nt">&gt;</span>pom<span class="nt">&lt;/packaging&gt;</span>

<span class="nt">&lt;name</span><span class="nt">&gt;</span>${project.artifactId}<span class="nt">&lt;/name&gt;</span>
<span class="nt">&lt;description</span><span class="nt">&gt;</span>Struts2 protobuf plugin parent<span class="nt">&lt;/description&gt;</span>
<span class="nt">&lt;url</span><span class="nt">&gt;</span>https://github.com/junahan/struts2-protobuf-plugin<span class="nt">&lt;/url&gt;</span>

<span class="nt">&lt;licenses</span><span class="nt">&gt;</span>
  <span class="nt">&lt;license</span><span class="nt">&gt;</span>
    <span class="nt">&lt;name</span><span class="nt">&gt;</span>Apache License, Version 2.0<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;url</span><span class="nt">&gt;</span>http://www.apache.org/licenses/LICENSE-2.0.txt<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;distribution</span><span class="nt">&gt;</span>repo<span class="nt">&lt;/distribution&gt;</span>
  <span class="nt">&lt;/license&gt;</span>
<span class="nt">&lt;/licenses&gt;</span>

<span class="nt">&lt;developers</span><span class="nt">&gt;</span>
  <span class="nt">&lt;developer</span><span class="nt">&gt;</span>
    <span class="nt">&lt;name</span><span class="nt">&gt;</span>Junahan<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;email</span><span class="nt">&gt;</span>junahan@outlook.com<span class="nt">&lt;/email&gt;</span>
  <span class="nt">&lt;/developer&gt;</span>
<span class="nt">&lt;/developers&gt;</span>

<span class="nt">&lt;scm</span><span class="nt">&gt;</span>
  <span class="nt">&lt;url</span><span class="nt">&gt;</span>https://github.com/junahan/struts2-protobuf-plugin<span class="nt">&lt;/url&gt;</span>
  <span class="nt">&lt;connection</span><span class="nt">&gt;</span>scm:git:https://github.com/junahan/struts2-protobuf-plugin.git<span class="nt">&lt;/connection&gt;</span>
  <span class="nt">&lt;developerConnection</span><span class="nt">&gt;</span>scm:git:git@github.com:junahan/struts2-protobuf-plugin.git<span class="nt">&lt;/developerConnection&gt;</span>
  <span class="nt">&lt;tag</span><span class="nt">&gt;</span>HEAD<span class="nt">&lt;/tag&gt;</span>
<span class="nt">&lt;/scm&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="配置-distribution-management"><span class="section-num">5.2</span> 配置 Distribution Management</h3>
<p>添加 Distribution Management 定义如下以指定 <code>ossrh</code> 仓库，这是我们部署发布包的中转仓库，并最终会发布至 Maven 中心仓库。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;distributionManagement</span><span class="nt">&gt;</span>
  <span class="nt">&lt;snapshotRepository</span><span class="nt">&gt;</span>
    <span class="nt">&lt;id</span><span class="nt">&gt;</span>ossrh<span class="nt">&lt;/id&gt;</span>
    <span class="nt">&lt;url</span><span class="nt">&gt;</span>https://oss.sonatype.org/content/repositories/snapshots<span class="nt">&lt;/url&gt;</span>
  <span class="nt">&lt;/snapshotRepository&gt;</span>
  <span class="nt">&lt;repository</span><span class="nt">&gt;</span>
    <span class="nt">&lt;id</span><span class="nt">&gt;</span>ossrh<span class="nt">&lt;/id&gt;</span>
    <span class="nt">&lt;url</span><span class="nt">&gt;</span>https://oss.sonatype.org/service/local/staging/deploy/maven2/<span class="nt">&lt;/url&gt;</span>
  <span class="nt">&lt;/repository&gt;</span>
<span class="nt">&lt;/distributionManagement&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="配置-maven-plugins"><span class="section-num">5.3</span> 配置 Maven Plugins</h3>
<p>发布过程需要使用到三个 Maven 插件:</p>
<ul>
<li>Maven Deploy 插件 - 用于执行 Snapshot 部署；</li>
<li>Nexus Staging 插件 - 用于执行 Release 部署及发布，推荐使用；</li>
<li>Maven Release 插件 - 用于执行 Release 部署及发布，支持发布标准流程，集成 SCM 以自动化执行版本号处理；</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;build</span><span class="nt">&gt;</span>
    <span class="nt">&lt;plugins</span><span class="nt">&gt;</span>
      <span class="c">&lt;!--</span><span class="c"> ... </span><span class="c">--&gt;</span>
      <span class="nt">&lt;plugin</span><span class="nt">&gt;</span>
        <span class="nt">&lt;groupId</span><span class="nt">&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId</span><span class="nt">&gt;</span>maven-deploy-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version</span><span class="nt">&gt;</span>${maven.deploy.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;configuration</span><span class="nt">&gt;</span>
          <span class="nt">&lt;skip</span><span class="nt">&gt;</span>${skip.maven.deploy}<span class="nt">&lt;/skip&gt;</span>
        <span class="nt">&lt;/configuration&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>

      <span class="nt">&lt;plugin</span><span class="nt">&gt;</span>
        <span class="nt">&lt;groupId</span><span class="nt">&gt;</span>org.sonatype.plugins<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId</span><span class="nt">&gt;</span>nexus-staging-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version</span><span class="nt">&gt;</span>${nexus.staging.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;extensions</span><span class="nt">&gt;</span>true<span class="nt">&lt;/extensions&gt;</span>
        <span class="nt">&lt;configuration</span><span class="nt">&gt;</span>
          <span class="nt">&lt;serverId</span><span class="nt">&gt;</span>ossrh<span class="nt">&lt;/serverId&gt;</span>
          <span class="nt">&lt;nexusUrl</span><span class="nt">&gt;</span>https://oss.sonatype.org/<span class="nt">&lt;/nexusUrl&gt;</span>
          <span class="nt">&lt;autoReleaseAfterClose</span><span class="nt">&gt;</span>true<span class="nt">&lt;/autoReleaseAfterClose&gt;</span>
        <span class="nt">&lt;/configuration&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>

      <span class="nt">&lt;plugin</span><span class="nt">&gt;</span>
        <span class="nt">&lt;groupId</span><span class="nt">&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId</span><span class="nt">&gt;</span>maven-release-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version</span><span class="nt">&gt;</span>${maven.release.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;configuration</span><span class="nt">&gt;</span>
          <span class="nt">&lt;autoVersionSubmodules</span><span class="nt">&gt;</span>true<span class="nt">&lt;/autoVersionSubmodules&gt;</span>
          <span class="nt">&lt;useReleaseProfile</span><span class="nt">&gt;</span>false<span class="nt">&lt;/useReleaseProfile&gt;</span>
          <span class="nt">&lt;releaseProfiles</span><span class="nt">&gt;</span>release<span class="nt">&lt;/releaseProfiles&gt;</span>
          <span class="nt">&lt;goals</span><span class="nt">&gt;</span>deploy nexus-staging:release<span class="nt">&lt;/goals&gt;</span>
        <span class="nt">&lt;/configuration&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
<span class="nt">&lt;/build&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="配置发布-profile"><span class="section-num">5.4</span> 配置发布 Profile</h3>
<p>发布 Profile 执行 Maven Source, Maven Javddoc, 和 Maven GPG 插件以准备好最终签名发布包。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;profiles</span><span class="nt">&gt;</span>
  <span class="nt">&lt;profile</span><span class="nt">&gt;</span>
    <span class="nt">&lt;id</span><span class="nt">&gt;</span>release<span class="nt">&lt;/id&gt;</span>
    <span class="nt">&lt;build</span><span class="nt">&gt;</span>
      <span class="nt">&lt;plugins</span><span class="nt">&gt;</span>
        <span class="nt">&lt;plugin</span><span class="nt">&gt;</span>
          <span class="nt">&lt;groupId</span><span class="nt">&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
          <span class="nt">&lt;artifactId</span><span class="nt">&gt;</span>maven-source-plugin<span class="nt">&lt;/artifactId&gt;</span>
          <span class="nt">&lt;version</span><span class="nt">&gt;</span>${maven.source.version}<span class="nt">&lt;/version&gt;</span>
          <span class="nt">&lt;executions</span><span class="nt">&gt;</span>
            <span class="nt">&lt;execution</span><span class="nt">&gt;</span>
              <span class="nt">&lt;id</span><span class="nt">&gt;</span>attach-sources<span class="nt">&lt;/id&gt;</span>
              <span class="nt">&lt;goals</span><span class="nt">&gt;</span>
                <span class="nt">&lt;goal</span><span class="nt">&gt;</span>jar-no-fork<span class="nt">&lt;/goal&gt;</span>
              <span class="nt">&lt;/goals&gt;</span>
            <span class="nt">&lt;/execution&gt;</span>
          <span class="nt">&lt;/executions&gt;</span>
        <span class="nt">&lt;/plugin&gt;</span>

        <span class="nt">&lt;plugin</span><span class="nt">&gt;</span>
          <span class="nt">&lt;groupId</span><span class="nt">&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
          <span class="nt">&lt;artifactId</span><span class="nt">&gt;</span>maven-javadoc-plugin<span class="nt">&lt;/artifactId&gt;</span>
          <span class="nt">&lt;version</span><span class="nt">&gt;</span>${maven.javadoc.version}<span class="nt">&lt;/version&gt;</span>
          <span class="nt">&lt;executions</span><span class="nt">&gt;</span>
            <span class="nt">&lt;execution</span><span class="nt">&gt;</span>
              <span class="nt">&lt;id</span><span class="nt">&gt;</span>attach-javadoc<span class="nt">&lt;/id&gt;</span>
              <span class="nt">&lt;goals</span><span class="nt">&gt;</span>
                <span class="nt">&lt;goal</span><span class="nt">&gt;</span>jar<span class="nt">&lt;/goal&gt;</span>
              <span class="nt">&lt;/goals&gt;</span>
              <span class="nt">&lt;configuration</span><span class="nt">&gt;</span>
                <span class="nt">&lt;doclint</span><span class="nt">&gt;</span>none<span class="nt">&lt;/doclint&gt;</span>
              <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/execution&gt;</span>
          <span class="nt">&lt;/executions&gt;</span>
          <span class="nt">&lt;configuration</span><span class="nt">&gt;</span>
            <span class="nt">&lt;show</span><span class="nt">&gt;</span>public<span class="nt">&lt;/show&gt;</span>
            <span class="nt">&lt;charset</span><span class="nt">&gt;</span>UTF-8<span class="nt">&lt;/charset&gt;</span>
            <span class="nt">&lt;encoding</span><span class="nt">&gt;</span>UTF-8<span class="nt">&lt;/encoding&gt;</span>
            <span class="nt">&lt;docencoding</span><span class="nt">&gt;</span>UTF-8<span class="nt">&lt;/docencoding&gt;</span>
            <span class="nt">&lt;links</span><span class="nt">&gt;</span>
              <span class="nt">&lt;link</span><span class="nt">&gt;</span>http://docs.oracle.com/javase/8/docs/api<span class="nt">&lt;/link&gt;</span>
            <span class="nt">&lt;/links&gt;</span>
          <span class="nt">&lt;/configuration&gt;</span>
        <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;plugin</span><span class="nt">&gt;</span>
          <span class="nt">&lt;groupId</span><span class="nt">&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
          <span class="nt">&lt;artifactId</span><span class="nt">&gt;</span>maven-gpg-plugin<span class="nt">&lt;/artifactId&gt;</span>
          <span class="nt">&lt;version</span><span class="nt">&gt;</span>${maven.gpg.version}<span class="nt">&lt;/version&gt;</span>
          <span class="nt">&lt;executions</span><span class="nt">&gt;</span>
            <span class="nt">&lt;execution</span><span class="nt">&gt;</span>
              <span class="nt">&lt;phase</span><span class="nt">&gt;</span>verify<span class="nt">&lt;/phase&gt;</span>
              <span class="nt">&lt;goals</span><span class="nt">&gt;</span>
                <span class="nt">&lt;goal</span><span class="nt">&gt;</span>sign<span class="nt">&lt;/goal&gt;</span>
              <span class="nt">&lt;/goals&gt;</span>
            <span class="nt">&lt;/execution&gt;</span>
          <span class="nt">&lt;/executions&gt;</span>
        <span class="nt">&lt;/plugin&gt;</span>
      <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>
  <span class="nt">&lt;/profile&gt;</span>
<span class="nt">&lt;/profiles&gt;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="配置-maven-setting"><span class="section-num">6</span> 配置 Maven Setting</h2>
<p>为了方便随后发布软件包，建议修改 Maven 配置以提供 GPG 签名和执行部署时所需要的认证信息。Maven 配置文件（settings.xml）位于 {HOME}/.m2/settings.xml，相关配置片段如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;servers</span><span class="nt">&gt;</span>
  <span class="nt">&lt;server</span><span class="nt">&gt;</span>
    <span class="nt">&lt;id</span><span class="nt">&gt;</span>ossrh<span class="nt">&lt;/id&gt;</span>
    <span class="nt">&lt;username</span><span class="nt">&gt;</span>{your-jira-id}<span class="nt">&lt;/username&gt;</span>
    <span class="nt">&lt;password</span><span class="nt">&gt;</span>{your-jira-pwd}<span class="nt">&lt;/password&gt;</span>
  <span class="nt">&lt;/server&gt;</span>
<span class="nt">&lt;/servers&gt;</span>

<span class="nt">&lt;profiles</span><span class="nt">&gt;</span>
  <span class="nt">&lt;profile</span><span class="nt">&gt;</span>
    <span class="nt">&lt;id</span><span class="nt">&gt;</span>ossrh<span class="nt">&lt;/id&gt;</span>
    <span class="nt">&lt;activation</span><span class="nt">&gt;</span>
      <span class="nt">&lt;activeByDefault</span><span class="nt">&gt;</span>true<span class="nt">&lt;/activeByDefault&gt;</span>
    <span class="nt">&lt;/activation&gt;</span>
    <span class="nt">&lt;properties</span><span class="nt">&gt;</span>
      <span class="nt">&lt;gpg.executable</span><span class="nt">&gt;</span>gpg<span class="nt">&lt;/gpg.executable&gt;</span>
      <span class="nt">&lt;gpg.passphrase</span><span class="nt">&gt;</span>{your-gpg-passphrase}<span class="nt">&lt;/gpg.passphrase&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>
  <span class="nt">&lt;/profile&gt;</span>
<span class="nt">&lt;/profiles&gt;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>Server 片段的配置提供 OSSRH 部署所需要的认证账户信息；</li>
<li>Profile 片段的配置则为部署期间执行 GPG 对发布包进行签名提供必要信息，特别是创建秘钥对时提供的 GPG passphrase 信息；</li>
</ul>
<p>注意：这里 server.id 和 profile.id 配置要和 POM 中 distributionManagement.id 配置以及 nexus-staging-maven-plugin.serverId 的配置保持一致。</p>
<h2 id="执行-snapshot-部署"><span class="section-num">7</span> 执行 Snapshot 部署</h2>
<p>Snapshot 部署简单容易，不需要满足发布 (Release) 部署的要求，只要项目版本号以 &ldquo;-SNAPSHOT&rdquo; 结尾即可，运行如下命令执行 Snapshot 部署：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">mvn clean deploy
</code></pre></td></tr></table>
</div>
</div><p>注意：按照配置，Snapshot 部署会将你的 Snapshot 版本包上传至 <a href="https://oss.sonatype.org/content/repositories/snapshots">OSSRH SNAPSHOT 仓库</a>。</p>
<h2 id="使用-nexus-staging-插件执行部署和发布"><span class="section-num">8</span> 使用 Nexus Staging 插件执行部署和发布</h2>
<p>推荐使用 Nexus Staging Maven 插件部署发布包至 OSSRH 并发布至 Maven 中心仓库。在<a href="#%E5%87%86%E5%A4%87%E9%A1%B9%E7%9B%AE-pom">准备项目 POM</a> 章节，我们已经介绍了如何配置 <code>nexus-staging-maven-plugin</code> 。
使用 Nexus Staging 插件部署发布版本之前，请修改你的项目版本号，确保版本号是发布版本（不以 -SNAPSHOT 为结尾），可以通过如下命令修改项目版本号为发布版本：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">mvn versions:set -DnewVersion<span class="o">=</span>1.0.0
</code></pre></td></tr></table>
</div>
</div><p>插件属性 <code>autoReleaseAfterClose</code> 配置为 <code>true</code> 时，执行如下命令即可部署发布版本至 OSSRH 且自动发布至 Maven 中心仓库：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">mvn clean deploy -p release
</code></pre></td></tr></table>
</div>
</div><p>插件属性 <code>autoReleaseAfterClose</code> 配置为 <code>false</code> 时，则需要手动通过 <a href="https://oss.sonatype.org/#welcome">Nexus 仓库管理员</a>界面检查和处理你的临时工作仓库并随后运行如下命令执行发布：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">mvn nexus-staging:release
</code></pre></td></tr></table>
</div>
</div><p>如果在部署期间发现问题，可以通过运行如下命令删除临时工作仓库：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">mvn nexus-staging:drop
</code></pre></td></tr></table>
</div>
</div><p>请注意，该方式执行发布版本部署的操作流程独立于 SCM 系统工作流，作为最佳实践，我们需要将发布到 Maven 中心仓库的版本对应我们 SCM 系统中的一个指定版本。这就需要手动处理项目版本号并手动操作代码库以确保在 SCM  系统中为发布版本打上相应的标签，建议遵循如下工作流程来发布版本：</p>
<ul>
<li>进行开发</li>
<li>提交所有需要发布的代码变更</li>
<li>验证并通过构建</li>
<li>更新版本号为发布版本</li>
<li>提交发布版本至代码库并打上相应的标签</li>
<li>运行部署</li>
<li>更新项目版本号为下一个 SNAPSHOT 版本号</li>
<li>提交新的 SNAPSHOT 版本</li>
<li>进行下个版本的开发并重复以上流程</li>
</ul>
<p>可以通过脚本或者 CI 系统或者使用 Maven Release 插件来自动化以上工作流，下面介绍使用 Maven Release 插件来实现自动化。</p>
<h2 id="使用-maven-release-插件执行部署和发布"><span class="section-num">9</span> 使用 Maven Release 插件执行部署和发布</h2>
<p>使用 <a href="http://maven.apache.org/maven-release/maven-release-plugin">Maven Release 插件</a> 可以自动化部署工作流，包括更新 Mavan POM 文件，执行 SCM 操作以及执行发布部署。使用 Maven Release 插件，需要确保：</p>
<ul>
<li>正确在 POM 中配置 SCM 信息以执行 SCM 相关的操作；</li>
<li>正确在 POM 中配置 Nexus Staging 插件以执行部署相关操作；</li>
<li>为了能够自动发布至 Maven 中心仓库，也需要确保配置 Nexus Staging 插件 autoReleaseAfterClose 属性的值为 <code>true</code> ；</li>
<li>关闭 Maven Super POM Release Profile, 使用我们自己 POM 中定义的 Release Profile；</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;plugin</span><span class="nt">&gt;</span>
  <span class="nt">&lt;groupId</span><span class="nt">&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId</span><span class="nt">&gt;</span>maven-release-plugin<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version</span><span class="nt">&gt;</span>${maven.release.version}<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;configuration</span><span class="nt">&gt;</span>
    <span class="nt">&lt;autoVersionSubmodules</span><span class="nt">&gt;</span>true<span class="nt">&lt;/autoVersionSubmodules&gt;</span>
    <span class="nt">&lt;useReleaseProfile</span><span class="nt">&gt;</span>false<span class="nt">&lt;/useReleaseProfile&gt;</span>
    <span class="nt">&lt;releaseProfiles</span><span class="nt">&gt;</span>release<span class="nt">&lt;/releaseProfiles&gt;</span>
    <span class="nt">&lt;goals</span><span class="nt">&gt;</span>deploy nexus-staging:release<span class="nt">&lt;/goals&gt;</span>
  <span class="nt">&lt;/configuration&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>如果一切配置正常，通过运行如下命令准备发布版本：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">mvn release:clean release:prepare
</code></pre></td></tr></table>
</div>
</div><p>在回答一些有关发布版本号，下个 SNAPSHOT 版本号等问题后，执行如下命令完成部署和发布：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">mvn release:perform
</code></pre></td></tr></table>
</div>
</div><p>Maven Release 插件为我们自动化如下工作流：</p>
<ul>
<li>修改项目 POM 版本号为指定发布版本，并提交该版本号变更至 SCM，并打上指定的标签；(release:prepare 命令)</li>
<li>修改项目 POM 版本号为下个 SNAPSHOT 版本，并提交变更至 SCM；(release:prepare 命令)</li>
<li>从 SCM 检出发布版本代码，运行构建任务创建发布包；（release:prepare 命令)</li>
<li>部署发布版至 OOSRH 临时工作仓库；（release:perform 命令）</li>
<li>关闭 OOSRH 临时工作仓库，Release 发布版至 Maven 中心仓库（通过 Nexus Staging 插件执行）；(release:perform 命令)</li>
</ul>
<p>注意：如果 Nexus Staging 插件属性 autoReleaseAfterClose 的值是 <code>false</code>, 仍然需要通过 <a href="https://oss.sonatype.org/#welcome">Nexus 仓库管理员</a>界面关闭临时工作仓库并执行发布以便发布至 Maven 中心仓库。
注意：完成发布后，大约 10 分钟既可以同步至 Maven 中心仓库，大约 2 小时候，就可以通过 <a href="https://search.maven.org">https://search.maven.org</a> 搜索到相应的发布包。</p>
<h2 id="gpg-plugin-issue"><span class="section-num">10</span> GPG Plugin Issue</h2>
<p>新版本的 GPG 在签名的时候会弹出一个交互 UI 以要求用户输入密码，maven-gpg-plugin 不能处理这种情形，从而导致报告错误 <a href="https://issues.apache.org/jira/browse/MGPG-59">gpg: signing failed: Inappropriate ioctl for device</a>。解决方法是配置 GPG 支持 –pinentry-mode loopback 模式。具体配置如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh"><span class="nb">cd</span> ~/.gnupg

<span class="c1"># 创建 gpg.conf</span>
<span class="nb">echo</span> <span class="s2">&#34;use-agent&#34;</span> &gt;&gt; gpg.conf
<span class="nb">echo</span> <span class="s2">&#34;pinentry-mode loopback&#34;</span> &gt;&gt; gpg.conf

<span class="c1"># 创建 gpg-agent.conf</span>
touch gpg-agent.conf
<span class="nb">echo</span> <span class="s2">&#34;allow-loopback-pinentry&#34;</span> &gt;&gt; gpg-agent.conf
</code></pre></td></tr></table>
</div>
</div><h2 id="参考文献"><span class="section-num">11</span> 参考文献</h2>
<ol>
<li>Guide to upload artifacts to the Central Repository, <a href="https://maven.apache.org/repository/guide-central-repository-upload.html">https://maven.apache.org/repository/guide-central-repository-upload.html</a>.</li>
<li>Requirement, <a href="https://central.sonatype.org/pages/requirements.html">https://central.sonatype.org/pages/requirements.html</a>.</li>
<li>Work with PGP Signatures, <a href="https://central.sonatype.org/pages/working-with-pgp-signatures.html">https://central.sonatype.org/pages/working-with-pgp-signatures.html</a>.</li>
<li>GPG Home, <a href="https://gnupg.org">https://gnupg.org</a>.</li>
<li>OSSRH Guide, <a href="https://central.sonatype.org/pages/ossrh-guide.html">https://central.sonatype.org/pages/ossrh-guide.html</a>.</li>
<li>Deployment Using Maven, <a href="https://central.sonatype.org/pages/apache-maven.html">https://central.sonatype.org/pages/apache-maven.html</a>.</li>
<li>Release the Deployment to Central Repository, <a href="https://central.sonatype.org/pages/releasing-the-deployment.html">https://central.sonatype.org/pages/releasing-the-deployment.html</a>.</li>
<li>记一次向maven中央仓库提交依赖包, <a href="http://www.cnblogs.com/wxisme/p/8728008.html">http://www.cnblogs.com/wxisme/p/8728008.html</a>.</li>
<li>GPG Plugin &ldquo;gpg: signing failed: Inappropriate ioctl for device&rdquo;, <a href="https://issues.apache.org/jira/browse/MGPG-59">https://issues.apache.org/jira/browse/MGPG-59</a>.</li>
<li>gpg: signing failed, <a href="https://dev.gnupg.org/T3716">https://dev.gnupg.org/T3716</a>.</li>
</ol>
<blockquote>
<p>本作品采用<a href="http://creativecommons.org/licenses/by/4.0/">知识共享署名 4.0 国际许可协议</a>进行许可。</p>
</blockquote>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">Junahan</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2018-08-02
        <a href="/commit/58bb9e7b9e6302020e5d03a2c3609135b39f679f" title="cleanup and add images.">(58bb9e7)</a>
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/maven/">Maven</a>
          <a href="/tags/java/">Java</a>
          <a href="/tags/gpg/">GPG</a>
          <a href="/tags/s101/">S101</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/envoy-the-universal-data-plane-api-cn/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Envoy 通用数据平面 API</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/solidity-dev-env/">
            <span class="next-text nav-default">Solidity 开发工具组合 - In Mac</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:junahan@outlook.com" class="iconfont icon-email" title="email"></a>
      <a href="https://www.linkedin.com/in/tiedang-yang-7a20b923/" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="https://github.com/junahan" class="iconfont icon-github" title="github"></a>
  <a href="/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2018 - 
    2020
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Junahan</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.min.js" integrity="sha256-jwCP0NAdCBloaIWTWHmW4i3snUNMHUNO+jr9rYd2iOI=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.locales.min.js" integrity="sha256-ZwofwC1Lf/faQCzN7nZtfijVV6hSwxjQMwXL4gn9qU8=" crossorigin="anonymous"></script>
  <script><!-- NOTE: timeago.js uses the language code format like "zh_CN" (underscore and case sensitive) -->
    var languageCode = "en".replace(/-/g, '_').replace(/_(.*)/, function ($0, $1) {return $0.replace($1, $1.toUpperCase());});
    timeago().render(document.querySelectorAll('.timeago'), languageCode);
    timeago.cancel();  
  </script>



<script type="text/javascript" src="/js/main.cddea96674a99fd8cea50d36fb19d9c91f497feea4af5ce4596afd2dbaab9202.js"></script>

<script id="baidu_analytics">
  var _hmt = _hmt || [];
  (function() {
    if (window.location.hostname === 'localhost') return;
    var hm = document.createElement("script"); hm.async = true;
    hm.src = "https://hm.baidu.com/hm.js?8c09186f09029d8bdbfa3282f58e4886";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>






</body>
</html>
